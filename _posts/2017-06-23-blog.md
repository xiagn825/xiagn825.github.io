---
layout: post
title: spring 接口支持返回多种格式
tags: java spring
---
## 1. 简介

本文介绍使用SpringMVC的后端服务如何通过配置来支持多种返回值类型（xml,json,html,excel）
>这里的代码使用的是springboot:https://github.com/xiagn825/springboot-todolist/tree/springboot-ContentNegotiation

## 2. 基础概念

### 2.1 HttpHeader中Content-Type和Accept设置的区别

Accept:接口要返回给客户端的数据格式
    
        curl --header 'Accept:application/json' http://localhost:8080/todo

Content-Type:客户端发送给服务器端的数据格式

        curl -X PUT --header 'Content-Type:application/json' -d '{"title":"周末日程","content":"睡觉"}'  http://localhost:8080/todo

### 2.2 SpringMVC生成输出的两种方式

1） 当服务端使用Restful的方式，只为客户端的ajax或其他服务端请求提供数据时，通常会使用@ResponseBody来标识你的返回，这时候Spring使用HttpMessageConverter来把返回的对象格式化成所需的格式。

2） 当你需要提供表现层(比如：HTML)，这时候SpringMVC使用ViewResolver来将处理你的返回。

### 2.3 SpringMVC输出格式评定

很多时候为了支持多个系统或多个终端，你需要让相同的数据已不同的表现形式输出。

SpringMVC使用ContentNegotationStrategy来判定用户请求希望得到什么格式的数据。

ContentNegotationStrategy通过三种方式来识别用户想要返回什么样的数据

1. 通过请求URL后缀：http://myserver/myapp/accounts/list.html 返回html格式
2. 通过请求的参数：http://myserver/myapp/accounts/list?format=xls 该设置默认不开启，默认key是format。
3. 通过HTTP Header的Accept：Accept:application/xml




优先级由上至下

这三个组件是用来处理返回不同格式输出的关键

* **HttpMessageConverters**: 将request中的参数转换成java对象，将java对象转换成相应的输出格式到response.

* **Request Mappings**: 决定不同的请求到不同的方法并返回不同的格式.

* **View Resolution**: 根据类型返回合适的表示层.


### 2.3 HttpMessageConverter

#### 2.3.1 The Default Message Converters

SpringMvc默认会加载下列HttpMessageConverters：

    ByteArrayHttpMessageConverter – converts byte arrays
    StringHttpMessageConverter – converts Strings
    ResourceHttpMessageConverter – converts org.springframework.core.io.Resource for any type of octet stream
    SourceHttpMessageConverter – converts javax.xml.transform.Source
    FormHttpMessageConverter – converts form data to/from a MultiValueMap<String, String>.
    Jaxb2RootElementHttpMessageConverter – converts Java objects to/from XML (added only if JAXB2 is present on the classpath)
    MappingJackson2HttpMessageConverter – converts JSON (added only if Jackson 2 is present on the classpath)
    MappingJacksonHttpMessageConverter – converts JSON (added only if Jackson is present on the classpath)
    AtomFeedHttpMessageConverter – converts Atom feeds (added only if Rome is present on the classpath)
    RssChannelHttpMessageConverter – converts RSS feeds (added only if Rome is present on the classpath)


















